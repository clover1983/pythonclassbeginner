<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Python Class 10 · Built-in Functions</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD + ReactDOM UMD (development builds) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel Standalone for in-browser JSX transform -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Pyodide v0.29: real Python in browser -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.29.0/full/pyodide.js"></script>
  <style>
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { from {transform:rotate(0)} to {transform:rotate(360deg)} }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
  </style>
</head>
<body class="bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useState } = React;

    // --- Boot Pyodide (v0.29) and inject helpers ---
    const pyodideReadyPromise = (async () => {
      const p = await loadPyodide({
        indexURL: "https://cdn.jsdelivr.net/pyodide/v0.29.0/full/"
      });
      await p.runPythonAsync([
        "import sys, io",
        "def _auto_strip_lines(src):",
        "    s = src.replace('\\r\\n','\\n').replace('\\r','\\n')",
        "    lines = s.split('\\n')",
        "    # keep indentation; only trim the end of each line",
        "    return '\\n'.join([ln.rstrip() for ln in lines])",
        "",
        "def run_user(src):",
        "    code = _auto_strip_lines(src)",
        "    glb = {}",
        "    _out = io.StringIO(); _err = io.StringIO()",
        "    old_out, old_err = sys.stdout, sys.stderr",
        "    sys.stdout, sys.stderr = _out, _err",
        "    try:",
        "        exec(code, glb, glb)",
        "    finally:",
        "        sys.stdout, sys.stderr = old_out, old_err",
        "    return {'glb': glb, 'out': _out.getvalue(), 'err': _err.getvalue(), 'code': code}",
      ].join('\n'));
      return p;
    })().catch(e => {
      console.error("Pyodide init failed:", e);
      alert("Pyodide init failed: " + e.message);
    });

    function usePyRunner() {
      const [pyodide, setPyodide] = useState(null);
      const [err, setErr] = useState(null);
      useEffect(() => {
        let mounted = true;
        pyodideReadyPromise.then(p => mounted && setPyodide(p)).catch(e => setErr(e));
        return () => { mounted = false; };
      }, []);
      return { pyodide, err };
    }

    // Keep glb as PyProxy; convert strings safely
    async function runUser(pyodide, code) {
      const run_user = pyodide.globals.get("run_user");
      const res = run_user(code); // dict PyProxy
      const getJs = (obj, key) => {
        const v = obj.get(key);
        return (v && typeof v.toJs === "function") ? v.toJs() : v;
      };
      const glb = res.get("glb");                 // PyProxy(dict)
      const out = getJs(res, "out");              // string
      const err = getJs(res, "err");              // string
      const codeNorm = getJs(res, "code");        // string
      res.destroy && res.destroy();
      return { glb, out, err, code: codeNorm };
    }

    // Helpers for equality checking of JS/pyodide-converted structures
    function deepEqual(a,b){
      if(a===b) return true;
      if(Array.isArray(a) && Array.isArray(b)){
        if(a.length!==b.length) return false;
        for(let i=0;i<a.length;i++){ if(!deepEqual(a[i], b[i])) return false; }
        return true;
      }
      if(a && b && typeof a==="object" && typeof b==="object"){
        // allow Map vs plain object comparisons
        const aIsMap = a && typeof a.get==="function" && typeof a.size==="number";
        const bIsMap = b && typeof b.get==="function" && typeof b.size==="number";
        if(aIsMap || bIsMap){
          const aSize = aIsMap ? a.size : Object.keys(a).length;
          const bSize = bIsMap ? b.size : Object.keys(b).length;
          if(aSize!==bSize) return false;
          const keys = aIsMap ? Array.from(a.keys()) : Object.keys(a);
          for(const k of keys){
            const av = aIsMap ? a.get(k) : a[k];
            const hasB = bIsMap ? b.has(k) : Object.prototype.hasOwnProperty.call(b,k);
            if(!hasB) return false;
            const bv = bIsMap ? b.get(k) : b[k];
            if(!deepEqual(av,bv)) return false;
          }
          return true;
        }
      }
      return false;
    }

    function Code({children}){
      return <pre className="bg-gray-950 text-gray-100 p-4 rounded-2xl text-sm overflow-auto shadow-inner mono"><code>{children}</code></pre>;
    }
    function Card({title, children, footer}){
      return (
        <div className="rounded-2xl shadow-lg border border-gray-200 bg-white p-5">
          <div className="text-xl font-semibold mb-3">{title}</div>
          <div className="space-y-3">{children}</div>
          {footer && <div className="pt-4 mt-4 border-t text-sm text-gray-600">{footer}</div>}
        </div>
      );
    }
    function Pill({ok, text}){
      const cls = ok == null ? "bg-gray-100 text-gray-800" : ok ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800";
      return <span className={"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium " + cls}>{text}</span>;
    }
    function Loader({text="Loading Python..."}){
      return (
        <div className="inline-flex items-center gap-2 text-sm text-gray-600">
          <svg className="w-4 h-4 spin" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" strokeWidth="3" opacity="0.3"/><path d="M21 12a9 9 0 0 0-9-9" stroke="currentColor" strokeWidth="3"/></svg>
          <span>{text}</span>
        </div>
      );
    }

    function Intro(){
      return (
        <Card title="Class 10: Popular Python Built-ins — fast tools you should know">
          <ul className="list-disc ml-6 space-y-1">
            <li>Essentials: <span className="mono">len</span>, <span className="mono">type</span>, <span className="mono">int/float/str</span>, <span className="mono">round</span>.</li>
            <li>Aggregators: <span className="mono">sum</span>, <span className="mono">min</span>, <span className="mono">max</span>.</li>
            <li>Iteration helpers: <span className="mono">sorted</span>, <span className="mono">enumerate</span>, <span className="mono">zip</span>, <span className="mono">reversed</span>.</li>
            <li>Functional friends: <span className="mono">map</span>, <span className="mono">filter</span>, <span className="mono">any</span>, <span className="mono">all</span>.</li>
            <li>Converting collections: <span className="mono">list</span>, <span className="mono">tuple</span>, <span className="mono">set</span>, <span className="mono">dict</span>.</li>
            <li>No imports needed — everything below uses the standard built-ins.</li>
          </ul>
        </Card>
      );
    }

    // Generic quiz component
    function PyQuiz({id, title, prompt, starter="", example, check}){
      const { pyodide, err } = usePyRunner();
      const [code, setCode] = useState(starter);
      const [status, setStatus] = useState({ ok: null, text: "Waiting for input" });
      const [showHint, setShowHint] = useState(false);

      async function run(){
        if(!pyodide){ setStatus({ok:null, text:"Python not ready"}); return; }
        setStatus({ok:null, text:"Running..."});
        try{
          const res = await runUser(pyodide, code);
          const glb = res.glb;
          const out = res.out;
          const err = res.err;
          const codeNorm = res.code;
          const get = (name) => {
            const pyv = glb.get(name);
            if (pyv === undefined || pyv === null) return undefined;
            return (typeof pyv.toJs === "function") ? pyv.toJs() : pyv;
          };

          const qpass = await check({glb, out, err, code: codeNorm, get});

          // Snapshot variables
          let snapshot = {};
          try {
            const ks = glb.keys();
            let names = (typeof ks.toJs === "function") ? ks.toJs() : [];
            names = Array.from(names).filter(name => name !== '__builtins__');
            for (const k of names) {
              const v = glb.get(k);
              snapshot[k] = (v && typeof v.toJs === "function") ? v.toJs() : v;
            }
          } catch (_) {}

          setStatus({
            ok: qpass,
            text: qpass ? "Correct" : "Not correct. See hints.",
            lastOut: out,
            lastErr: err,
            lastVars: snapshot
          });

          glb.destroy && glb.destroy();

        }catch(e){
          setStatus({ok:false, text:"Python error: " + e.message});
        }
      }

      return (
        <Card title={title}>
          <p>{prompt}</p>
          <textarea className="w-full h-28 border rounded-xl p-3 mono" value={code} onChange={e=>setCode(e.target.value)} placeholder="Write Python here..." />
          <div className="flex items-center gap-3">
            <button onClick={run} className="px-4 py-2 rounded-xl bg-blue-600 text-white shadow">Run</button>
            <Pill ok={status.ok} text={status.text} />
            {(status.lastOut || status.lastErr) && (
              <div className="text-xs mono text-gray-700">
                {status.lastOut ? <div>stdout: {String(status.lastOut)}</div> : null}
                {status.lastErr ? <div>stderr: {String(status.lastErr)}</div> : null}
              </div>
            )}
            {status.lastVars && Object.keys(status.lastVars).length > 0 && (
              <pre className="bg-slate-100 text-slate-800 text-xs p-2 rounded mono overflow-auto">
                {JSON.stringify(status.lastVars, null, 2)}
              </pre>
            )}
            {!pyodide && <Loader />}
          </div>
          {example && (
            <div className="mt-2">
              <button
                onClick={() => setShowHint(s => !s)}
                className="px-3 py-1 rounded-lg text-sm border bg-white hover:bg-gray-50"
              >
                {showHint ? "Hide hint" : "Show hint"}
              </button>
              {showHint && <Code>{example}</Code>}
            </div>
          )}
        </Card>
      );
    }

    function App(){
      const [score, setScore] = useState(0);
      const [done, setDone] = useState({});
      function onPass(key){
        if (!done[key]) {
          setDone(prev => ({...prev, [key]: true}));
          setScore(s => s + 1);
        }
      }
      const total = 9;
      const progress = Math.round(Object.keys(done).length/total*100);

      return (
        <div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100">
          <header className="max-w-5xl mx-auto px-6 py-8">
            <h1 className="text-3xl font-bold tracking-tight">Python Class 10 · Built-in Functions</h1>
            <p className="text-gray-600 mt-1">Complete {total} quizzes. Real Python runs in your browser.</p>
          </header>

          <main className="max-w-5xl mx-auto px-6 pb-20 space-y-6">
            <div className="rounded-2xl border bg-white p-5 flex items-center gap-4 shadow-sm">
              <div className="w-28">
                <div className="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                  <div className="h-3 bg-blue-600" style={{ width: progress + "%" }} />
                </div>
              </div>
              <div className="text-sm text-gray-700">Progress: {Object.keys(done).length}/{total} · Score: {score}</div>
              <div className="ml-auto text-sm text-gray-500">Tip: Use the examples as a starting point.</div>
            </div>

            <Intro />

            <PyQuiz
              id="q1"
              title="Q1 · len and type"
              prompt='Make a = [1,2,3]; set n = len(a) and t = type(a).__name__. Pass if n == 3 and t == "list"; code must use len('
              example={`a = [1,2,3]\nn = len(a)\nt = type(a).__name__`}
              check={({get, code}) => {
                const n = get("n"); const t = get("t");
                const usedLen = /len\(/.test(code);
                const ok = usedLen && n === 3 && t === "list";
                if (ok) onPass("q1");
                return ok;
              }}
            />

            <PyQuiz
              id="q2"
              title="Q2 · int, float, str conversions"
              prompt='Set i = int("42"), f = float("3.5"), s = str(100). Pass if i == 42, f == 3.5, s == "100"; code must use int( float( str('
              example={`i = int("42")\nf = float("3.5")\ns = str(100)`}
              check={({get, code}) => {
                const i = get("i"); const f = get("f"); const s = get("s");
                const used = /int\(/.test(code) && /float\(/.test(code) && /str\(/.test(code);
                const ok = used && i === 42 && f === 3.5 && s === "100";
                if (ok) onPass("q2");
                return ok;
              }}
            />

            <PyQuiz
              id="q3"
              title="Q3 · round and precision"
              prompt='Compute r = round(3.14159, 2). Pass if r == 3.14 and code uses round('
              example={`r = round(3.14159, 2)`}
              check={({get, code}) => {
                const r = get("r");
                const used = /round\(/.test(code);
                const ok = used && r === 3.14;
                if (ok) onPass("q3");
                return ok;
              }}
            />

            <PyQuiz
              id="q4"
              title="Q4 · sum, min, max"
              prompt='Use nums = [5,1,9]. Make s = sum(nums), mn = min(nums), mx = max(nums). Pass if s==15, mn==1, mx==9 and code uses sum( min( max('
              example={`nums = [5,1,9]\ns = sum(nums)\nmn = min(nums)\nmx = max(nums)`}
              check={({get, code}) => {
                const s = get("s"); const mn = get("mn"); const mx = get("mx");
                const used = /sum\(/.test(code) && /min\(/.test(code) && /max\(/.test(code);
                const ok = used && s === 15 && mn === 1 && mx === 9;
                if (ok) onPass("q4");
                return ok;
              }}
            />

            <PyQuiz
              id="q5"
              title="Q5 · sorted with reverse and key"
              prompt='Use words = ["pear","apple","banana"]. Make a = sorted(words), b = sorted(words, reverse=True), c = sorted(words, key=len). Pass if a[0]=="apple", b[0]=="pear", c[0]=="pear".'
              example={`words = ["pear","apple","banana"]\na = sorted(words)\nb = sorted(words, reverse=True)\nc = sorted(words, key=len)`}
              check={({get}) => {
                const a = get("a"); const b = get("b"); const c = get("c");
                const ok = Array.isArray(a) && Array.isArray(b) && Array.isArray(c) && a[0]==="apple" && b[0]==="pear" && c[0]==="pear";
                if (ok) onPass("q5");
                return ok;
              }}
            />

            <PyQuiz
              id="q6"
              title="Q6 · enumerate builds index-value pairs"
              prompt='Use pets = ["cat","dog"]. Make pairs = list(enumerate(pets)). Pass if pairs equals [(0,"cat"), (1,"dog")].'
              example={`pets = ["cat","dog"]\npairs = list(enumerate(pets))`}
              check={({get}) => {
                const pairs = get("pairs");
                const ok = Array.isArray(pairs) && pairs.length===2 && Array.isArray(pairs[0]) && pairs[0][0]===0 && pairs[0][1]==="cat" && pairs[1][0]===1 && pairs[1][1]==="dog";
                if (ok) onPass("q6");
                return ok;
              }}
            />

            <PyQuiz
              id="q7"
              title="Q7 · zip merges sequences"
              prompt='Use a = [1,2], b = ["x","y"]. Make z = list(zip(a,b)). Pass if z == [(1,"x"),(2,"y")].'
              example={`a = [1,2]\nb = ["x","y"]\nz = list(zip(a,b))`}
              check={({get}) => {
                const z = get("z");
                const ok = Array.isArray(z) && z.length===2 && Array.isArray(z[0]) && z[0][0]===1 && z[0][1]==="x" && z[1][0]===2 && z[1][1]==="y";
                if (ok) onPass("q7");
                return ok;
              }}
            />

            <PyQuiz
              id="q8"
              title="Q8 · any and all"
              prompt='With vals = [0, 1, 2]. Make a = any(vals) and b = all([True, 1, "nonempty"]). Pass if a is True and b is True; code must use any( and all('
              example={`vals = [0, 1, 2]\na = any(vals)\nb = all([True, 1, "nonempty"])`}
              check={({get, code}) => {
                const a = get("a"); const b = get("b");
                const used = /any\(/.test(code) && /all\(/.test(code);
                const ok = used && a === true && b === true;
                if (ok) onPass("q8");
                return ok;
              }}
            />

            <PyQuiz
              id="q9"
              title="Q9 · map and filter (convert to list)"
              prompt='Make nums = [0,1,2,3]. squares = list(map(lambda x: x*x, nums)). evens = list(filter(lambda x: x%2==0, nums)). Pass if squares == [0,1,4,9] and evens == [0,2].'
              example={`nums = [0,1,2,3]\nsquares = list(map(lambda x: x*x, nums))\nevens = list(filter(lambda x: x%2==0, nums))`}
              check={({get}) => {
                const squares = get("squares"); const evens = get("evens");
                const ok = Array.isArray(squares) && Array.isArray(evens) &&
                  squares.length===4 && squares[0]===0 && squares[1]===1 && squares[2]===4 && squares[3]===9 &&
                  evens.length===2 && evens[0]===0 && evens[1]===2;
                if (ok) onPass("q9");
                return ok;
              }}
            />

            <Card title="Recap & Tips" footer="Mastering a small set of built-ins pays off everywhere. Prefer clear built-ins over manual loops when they express your intent.">
              <ul className="list-disc ml-6 space-y-1">
                <li>Start with <span className="mono">len, sum, min, max, sorted</span> — they solve most everyday needs.</li>
                <li>Use <span className="mono">enumerate</span> instead of manual counters; <span className="mono">zip</span> for parallel iteration.</li>
                <li><span className="mono">any</span>/<span className="mono">all</span> turn lists of conditions into a single boolean.</li>
                <li><span className="mono">map</span>/<span className="mono">filter</span> are concise; list comprehensions are often even clearer.</li>
              </ul>
            </Card>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>